diff --git a/src/expr.c b/src/expr.c
--- a/src/expr.c
+++ b/src/expr.c
@@ -4017,6 +4017,7 @@ void sqlite3ExprCodeGeneratedColumn(
   int iAddr;
   Vdbe *v = pParse->pVdbe;
   int nErr = pParse->nErr;
+  if( pParse->nErr ) return;
   assert( v!=0 );
   assert( pParse->iSelfTab!=0 );
   if( pParse->iSelfTab>0 ){
@@ -4029,6 +4030,7 @@ void sqlite3ExprCodeGeneratedColumn(
     sqlite3VdbeAddOp4(v, OP_Affinity, regOut, 1, 0, &pCol->affinity, 1);
   }
   if( iAddr ) sqlite3VdbeJumpHere(v, iAddr);
+  pParse->db->errByteOffset = -1;
 }
 #endif /* SQLITE_OMIT_GENERATED_COLUMNS */
 
diff --git a/src/shell.c.in b/src/shell.c.in
--- a/src/shell.c.in
+++ b/src/shell.c.in
@@ -2889,6 +2889,7 @@ static char *shell_error_context(const char *zSql, sqlite3 *db){
   if( db==0
    || zSql==0
    || (iOffset = sqlite3_error_offset(db))<0
+   || iOffset>=strlen(zSql)
   ){
     return sqlite3_mprintf("");
   }
